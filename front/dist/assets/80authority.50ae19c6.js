/*! 
 Build based on gin-vue-admin 
 Time : 1718187330000 */
import{a,o as e,d as t,e as l,g as r,w as o,k as u,j as i,f as d,S as s,m as n,s as p,U as h,W as m,aw as y,q as v,n as c,E as f,$ as I,ah as g,ai as b,aq as w}from"./80index.9ee49f24.js";import"./80drawer.4ed993c7.js";import"./80overlay.4ed993c7.js";import"./80tab-pane.4ed993c7.js";import"./80dialog.4ed993c7.js";import"./80form-item.4ed993c7.js";import"./80input.4ed993c7.js";import"./80radio.4ed993c7.js";import"./80popper.4ed993c7.js";import"./80tag.4ed993c7.js";import"./80checkbox.4ed993c7.js";import"./80scrollbar.4ed993c7.js";import"./80table-column.4ed993c7.js";import"./80tooltip.4ed993c7.js";import"./80button.4ed993c7.js";import{g as _,d as j,c as k,u as N,a as C}from"./80authority.9f8b634f.js";import V from"./80menus.16d450bf.js";import x from"./80apis.383fc416.js";import"./80checkbox-group.4ed993c7.js";import"./80icon.4ed993c7.js";import"./80warningBar.vue_vue_type_style_index_0_scoped_a7c6b110_lang.4ed993c7.js";import"./80tree.4ed993c7.js";import"./80_plugin-vue_export-helper.1b428a4d.js";import"./80api.bea01077.js";const A={class:"authority"},S={class:"gva-table-box"},U={class:"gva-btn-list"},q={class:"dialog-footer"},D={name:"Authority"},E=Object.assign(D,{setup(D){const E=a([{authorityId:0,authorityName:"根角色"}]),z=a(!1),B=a("add"),R=a({}),$=a("新增角色"),F=a(!1),O=a(!1),P=a({}),T=a({authorityId:0,authorityName:"",parentId:0}),G=a({authorityId:[{required:!0,message:"请输入角色ID",trigger:"blur"},{validator:(a,e,t)=>/^[0-9]*[1-9][0-9]*$/.test(e)?t():t(new Error("请输入正整数")),trigger:"blur",message:"必须为正整数"}],authorityName:[{required:!0,message:"请输入角色名",trigger:"blur"}],parentId:[{required:!0,message:"请选择父角色",trigger:"blur"}]}),J=a(1),M=a(0),Q=a(999),W=a([]),X=a({}),Z=async()=>{const a=await _({page:J.value,pageSize:Q.value,...X.value});0===a.code&&(W.value=a.data.list,M.value=a.data.total,J.value=a.data.page,Q.value=a.data.pageSize)};Z();const H=(a,e)=>{R.value[a]=e},K=a(null),L=a(null),Y=a(null),aa=(a,e)=>{const t=[K,L,Y];e&&t[e].value.needConfirm&&(t[e].value.enterAndNext(),t[e].value.needConfirm=!1)},ea=a(null),ta=()=>{ea.value&&ea.value.resetFields(),T.value={authorityId:0,authorityName:"",parentId:0}},la=()=>{ta(),F.value=!1,O.value=!1},ra=()=>{if(T.value.authorityId=Number(T.value.authorityId),0===T.value.authorityId)return n({type:"error",message:"角色id不能为0"}),!1;ea.value.validate((async a=>{if(a){switch(B.value){case"add":0===(await C(T.value)).code&&(n({type:"success",message:"添加成功!"}),Z(),la());break;case"edit":0===(await N(T.value)).code&&(n({type:"success",message:"添加成功!"}),Z(),la());break;case"copy":{const a={authority:{authorityId:0,authorityName:"",datauthorityId:[],parentId:0},oldAuthorityId:0};a.authority.authorityId=T.value.authorityId,a.authority.authorityName=T.value.authorityName,a.authority.parentId=T.value.parentId,a.authority.dataAuthorityId=P.value.dataAuthorityId,a.oldAuthorityId=P.value.authorityId;0===(await k(a)).code&&(n({type:"success",message:"复制成功！"}),Z())}}ta(),F.value=!1}}))},oa=()=>{E.value=[{authorityId:0,authorityName:"根角色"}],ua(W.value,E.value,!1)},ua=(a,e,t)=>{T.value.authorityId=String(T.value.authorityId),a&&a.forEach((a=>{if(a.children&&a.children.length){const l={authorityId:a.authorityId,authorityName:a.authorityName,disabled:t||a.authorityId===T.value.authorityId,children:[]};ua(a.children,l.children,t||a.authorityId===T.value.authorityId),e.push(l)}else{const l={authorityId:a.authorityId,authorityName:a.authorityName,disabled:t||a.authorityId===T.value.authorityId};e.push(l)}}))};return(a,_)=>{const k=p,N=h,C=m,D=y,O=v,P=c,M=f,Q=I,X=g,Y=b,ua=w;return e(),t("div",A,[l("div",S,[l("div",U,[r(k,{type:"primary",icon:"plus",onClick:_[0]||(_[0]=a=>{return e=0,ta(),$.value="新增角色",B.value="add",T.value.parentId=e,oa(),void(F.value=!0);var e})},{default:o((()=>[u("新增角色")])),_:1})]),r(C,{data:W.value,"tree-props":{children:"children",hasChildren:"hasChildren"},"row-key":"authorityId",style:{width:"100%"}},{default:o((()=>[r(N,{label:"角色ID","min-width":"180",prop:"authorityId"}),r(N,{align:"left",label:"角色名称","min-width":"180",prop:"authorityName"}),r(N,{align:"left",label:"操作",width:"460"},{default:o((a=>[r(k,{icon:"setting",type:"primary",link:"",onClick:e=>{return t=a.row,z.value=!0,void(R.value=t);var t}},{default:o((()=>[u("设置权限")])),_:2},1032,["onClick"]),r(k,{icon:"edit",type:"primary",link:"",onClick:e=>(a=>{oa(),$.value="编辑角色",B.value="edit";for(const e in T.value)T.value[e]=a[e];oa(),F.value=!0})(a.row)},{default:o((()=>[u("编辑")])),_:2},1032,["onClick"]),r(k,{icon:"delete",type:"primary",link:"",onClick:e=>{return t=a.row,void s.confirm("此操作将永久删除该角色, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await j({authorityId:t.authorityId})).code&&(n({type:"success",message:"删除成功!"}),1===W.value.length&&J.value>1&&J.value--,Z())})).catch((()=>{n({type:"info",message:"已取消删除"})}));var t}},{default:o((()=>[u("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"])]),r(Q,{modelValue:F.value,"onUpdate:modelValue":_[4]||(_[4]=a=>F.value=a),title:$.value},{footer:o((()=>[l("div",q,[r(k,{onClick:la},{default:o((()=>[u("取 消")])),_:1}),r(k,{type:"primary",onClick:ra},{default:o((()=>[u("确 定")])),_:1})])])),default:o((()=>[r(M,{ref_key:"authorityForm",ref:ea,model:T.value,rules:G.value,"label-width":"80px"},{default:o((()=>[r(O,{label:"父级角色",prop:"parentId"},{default:o((()=>[r(D,{modelValue:T.value.parentId,"onUpdate:modelValue":_[1]||(_[1]=a=>T.value.parentId=a),style:{width:"100%"},disabled:"add"===B.value,options:E.value,props:{checkStrictly:!0,label:"authorityName",value:"authorityId",disabled:"disabled",emitPath:!1},"show-all-levels":!1,filterable:""},null,8,["modelValue","disabled","options"])])),_:1}),r(O,{label:"角色ID",prop:"authorityId"},{default:o((()=>[r(P,{modelValue:T.value.authorityId,"onUpdate:modelValue":_[2]||(_[2]=a=>T.value.authorityId=a),disabled:"edit"===B.value,autocomplete:"off"},null,8,["modelValue","disabled"])])),_:1}),r(O,{label:"角色姓名",prop:"authorityName"},{default:o((()=>[r(P,{modelValue:T.value.authorityName,"onUpdate:modelValue":_[3]||(_[3]=a=>T.value.authorityName=a),autocomplete:"off"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),z.value?(e(),i(ua,{key:0,modelValue:z.value,"onUpdate:modelValue":_[5]||(_[5]=a=>z.value=a),"custom-class":"auth-drawer","with-header":!1,size:"40%",title:"角色配置"},{default:o((()=>[r(Y,{"before-leave":aa,type:"border-card"},{default:o((()=>[r(X,{label:"角色菜单"},{default:o((()=>[r(V,{ref_key:"menus",ref:K,row:R.value,onChangeRow:H},null,8,["row"])])),_:1}),r(X,{label:"角色api"},{default:o((()=>[r(x,{ref_key:"apis",ref:L,row:R.value,onChangeRow:H},null,8,["row"])])),_:1})])),_:1})])),_:1},8,["modelValue"])):d("",!0)])}}});export{E as default};
