/*! 
 Build based on gin-vue-admin 
 Time : 1690887351000 */
import{O as e,a as t,b as a,o as s,d as i,f as o,w as l,k as n,t as r,X as d,m as h,s as p,aM as u}from"./80index.fb469218.js";import"./80progress.4ed993c7.js";import"./80button.4ed993c7.js";import{_ as c}from"./80_plugin-vue_export-helper.1b428a4d.js";const m=t=>e({url:"/fileUploadAndDownload/getFileList",method:"post",data:t}),f=t=>e({url:"/fileUploadAndDownload/deleteFile",method:"post",data:t}),g=t=>e({url:"/fileUploadAndDownload/editFileName",method:"post",data:t}),w=()=>e({url:"/fileUploadAndDownload/cfg",method:"get"});class y{constructor(e,t,a=1920){this.file=e,this.fileSize=t,this.maxWH=a}compress(){const e=this.file.type,t=this.file.size/1024;return new Promise((a=>{const s=new FileReader;s.readAsDataURL(this.file),s.onload=()=>{const i=document.createElement("canvas"),o=document.createElement("img");o.src=s.result,o.onload=()=>{const s=i.getContext("2d"),l=this.dWH(o.width,o.height,this.maxWH);i.width=l.width,i.height=l.height,s.clearRect(0,0,i.width,i.height),s.drawImage(o,0,0,i.width,i.height);const n=i.toDataURL(e,.9),r=this.fileSizeKB(n);r>this.fileSize&&console.log("图片尺寸太大!"+t+" >> "+r);const d=this.dataURLtoBlob(n,e),h=new File([d],this.file.name);a(h)}}}))}dWH(e,t,a){const s={width:e,height:t};return Math.max(e,t)>a?e>t?(s.width=a,s.height=Math.round(t*(a/e)),s):(s.height=a,s.width=Math.round(e*(a/t)),s):s}fileSizeKB(e){let t=0;return t=Math.round(3*e.split(",")[1].length/4/1024),t}dataURLtoBlob(e,t){const a=atob(e.split(",")[1]);let s=e.split(",")[0].split(":")[1].split(";")[0];const i=new ArrayBuffer(a.length),o=new Uint8Array(i);for(let l=0;l<a.length;l++)o[l]=a.charCodeAt(l);return t&&(s=t),new Blob([i],{type:s,lastModifiedDate:new Date})}}const b={name:"UploadImage",methods:{}},U=c(Object.assign(b,{props:{imageUrl:{type:String,default:""},fileSize:{type:Number,default:2048},maxWH:{type:Number,default:4096},btnName:{type:String,default:"上传"},oss:{type:String,default:""}},emits:["on-success"],setup(e,{emit:c}){const m=e,f=t("/_sys"),g=a(),w=e=>{const t="image/jpeg"===e.type,a="image/png"===e.type;if(!t&&!a)return h.error("上传头像图片只能是 jpg或png 格式!"),!1;if(!(e.size/1024<m.fileSize))return h.error(`上传头像图片大小应小于 ${m.fileSize}KB`),!1;return new y(e,m.fileSize,m.maxWH).compress()},b=e=>{c("on-success")};return(e,t)=>{const a=p,h=u;return s(),i("div",null,[o(h,{action:`${f.value}/fileUploadAndDownload/upload?driver=${m.oss}`,headers:{Authorization:"Bearer "+d(g).token},"show-file-list":!1,"on-success":b,"before-upload":w,multiple:!1},{default:l((()=>[o(a,{type:"primary"},{default:l((()=>[n("上传至"+r(m.btnName),1)])),_:1})])),_:1},8,["action","headers"])])}}}),[["__scopeId","data-v-8b97fe3c"]]);export{U,f as d,g as e,m as g,w as u};
