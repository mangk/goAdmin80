/*! 
 Build based on gin-vue-admin 
 Time : 1684227215000 */
import{r as a,P as e,o as t,c as l,d as o,e as s,w as n,j as i,t as r,W as p,X as u,l as c,m,n as d,q as g,E as f,Y as v,Z as h,_ as w,$ as y,a0 as j}from"./80index.4aac0417.js";import"./80loading.4ed993c7.js";import"./80pagination.4ed993c7.js";import"./80input.4ed993c7.js";import"./80tag.4ed993c7.js";import"./80select.4ed993c7.js";import"./80scrollbar.4ed993c7.js";import"./80popper.4ed993c7.js";import"./80table-column.4ed993c7.js";import"./80checkbox.4ed993c7.js";import"./80tooltip.4ed993c7.js";import"./80form-item.4ed993c7.js";import"./80button.4ed993c7.js";import{_,U as b,g as x,d as C,e as k}from"./80common.ca2c36f2.js";import{C as U}from"./80index.391a3388.js";import{f as z}from"./80format.8a1a01fd.js";import{W as E}from"./80warningBar.a849a09b.js";import{_ as O}from"./80_plugin-vue_export-helper.1b428a4d.js";import"./80progress.4ed993c7.js";import"./80icon.4ed993c7.js";const S=(a,e)=>{var t=new Image;t.setAttribute("crossOrigin","anonymous"),t.onload=function(){var a=document.createElement("canvas");a.width=t.width,a.height=t.height,a.getContext("2d").drawImage(t,0,0,t.width,t.height);var l=a.toDataURL("image/png"),o=document.createElement("a"),s=new MouseEvent("click");o.download=e||"photo",o.href=l,o.dispatchEvent(s)},t.src=a},B={class:"gva-table-box"},T={class:"gva-btn-list"},V=["onClick"],I={class:"gva-pagination"},L={name:"Upload"},M=O(Object.assign(L,{setup(O){const L=a("/_sys"),M=a(""),P=a(""),W=a(1),A=a(0),D=a(10),R=a({}),q=a([]),F=a=>{D.value=a,J()},G=a=>{W.value=a,J()},J=async()=>{const a=await x({page:W.value,pageSize:D.value,...R.value});0===a.code&&(q.value=a.data.list,A.value=a.data.total,W.value=a.data.page,D.value=a.data.pageSize)};J();return(a,x)=>{const O=m,K=d,N=g,Q=f,X=v,Y=h,Z=w,$=y,H=j;return e((t(),l("div",null,[o("div",B,[s(E,{title:"点击“文件名/备注”可以编辑文件名或者备注内容。"}),o("div",T,[s(_,{imageCommon:P.value,"onUpdate:imageCommon":x[0]||(x[0]=a=>P.value=a),class:"upload-btn",onOnSuccess:J},null,8,["imageCommon"]),s(b,{imageUrl:M.value,"onUpdate:imageUrl":x[1]||(x[1]=a=>M.value=a),"file-size":512,"max-w-h":1080,class:"upload-btn",onOnSuccess:J},null,8,["imageUrl"]),s(Q,{ref:"searchForm",inline:!0,model:R.value},{default:n((()=>[s(K,{label:""},{default:n((()=>[s(O,{modelValue:R.value.keyword,"onUpdate:modelValue":x[2]||(x[2]=a=>R.value.keyword=a),class:"keyword",placeholder:"请输入文件名或备注"},null,8,["modelValue"])])),_:1}),s(K,null,{default:n((()=>[s(N,{type:"primary",icon:"search",onClick:J},{default:n((()=>[i("查询")])),_:1})])),_:1})])),_:1},8,["model"])]),s(Z,{data:q.value},{default:n((()=>[s(X,{align:"left",label:"预览",width:"100"},{default:n((a=>[s(U,{"pic-type":"file","pic-src":a.row.url},null,8,["pic-src"])])),_:1}),s(X,{align:"left",label:"日期",prop:"UpdatedAt",width:"180"},{default:n((a=>[o("div",null,r(p(z)(a.row.ut)),1)])),_:1}),s(X,{align:"left",label:"文件名/备注",prop:"name",width:"180"},{default:n((a=>[o("div",{class:"name",onClick:e=>(async a=>{u.prompt("请输入文件名或者备注","编辑",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/\S/,inputErrorMessage:"不能为空",inputValue:a.name}).then((async({value:e})=>{a.name=e,0===(await k(a)).code&&(c({type:"success",message:"编辑成功!"}),J())})).catch((()=>{c({type:"info",message:"取消修改"})}))})(a.row)},r(a.row.name),9,V)])),_:1}),s(X,{align:"left",label:"链接",prop:"url","min-width":"300"}),s(X,{align:"left",label:"标签",prop:"tag",width:"100"},{default:n((a=>[s(Y,{type:"jpg"===a.row.tag?"primary":"success","disable-transitions":""},{default:n((()=>[i(r(a.row.tag),1)])),_:2},1032,["type"])])),_:1}),s(X,{align:"left",label:"操作",width:"160"},{default:n((a=>[s(N,{icon:"download",type:"primary",link:"",onClick:e=>{var t;(t=a.row).url.indexOf("http://")>-1||t.url.indexOf("https://")>-1?S(t.url,t.name):S(L.value+"/"+t.url,t.name)}},{default:n((()=>[i("下载")])),_:2},1032,["onClick"]),s(N,{icon:"delete",type:"primary",link:"",onClick:e=>(async a=>{u.confirm("此操作将永久删除文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((async()=>{0===(await C(a)).code&&(c({type:"success",message:"删除成功!"}),1===q.value.length&&W.value>1&&W.value--,J())})).catch((()=>{c({type:"info",message:"已取消删除"})}))})(a.row)},{default:n((()=>[i("删除")])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),o("div",I,[s($,{"current-page":W.value,"page-size":D.value,"page-sizes":[10,30,50,100],style:{float:"right",padding:"20px"},total:A.value,layout:"total, sizes, prev, pager, next, jumper",onCurrentChange:G,onSizeChange:F},null,8,["current-page","page-size","total"])])])])),[[H,a.fullscreenLoading,void 0,{fullscreen:!0,lock:!0}]])}}}),[["__scopeId","data-v-572318f5"]]);export{M as default};
