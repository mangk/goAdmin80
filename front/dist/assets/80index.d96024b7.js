/*! 
 Build based on gin-vue-admin 
 Time : 1727164229000 */
import{a as e,b as a,o as l,d as t,g as s,w as o,k as r,D as n,m as i,s as u,aK as m,j as p,e as c,F as d,B as g,t as v,S as y,n as f,q as j,E as b,N as h,aO as C,X as _,aq as k}from"./80index.40ff549f.js";import"./80drawer.4ed993c7.js";import"./80overlay.4ed993c7.js";import"./80pagination.4ed993c7.js";import"./80tag.4ed993c7.js";import"./80select.4ed993c7.js";import"./80scrollbar.4ed993c7.js";import"./80popper.4ed993c7.js";import"./80form-item.4ed993c7.js";import"./80button.4ed993c7.js";import"./80input.4ed993c7.js";import{U as x,g as w,e as U}from"./80image.a3c6394d.js";import"./80progress.4ed993c7.js";import{W as z}from"./80warningBar.8e2ce2b5.js";const S={name:"UploadCommon",methods:{}},V=Object.assign(S,{emits:["on-success"],setup(p,{emit:c}){const d=e("/_sys"),g=a(),v=e(!1),y=e=>{v.value=!0;const a="image/jpeg"===e.type,l="image/png"===e.type,t=e.size/1024/1024<.5;return a||l||(i.error("上传图片只能是 jpg或png 格式!"),v.value=!1),t||(i.error("未压缩的上传图片大小不能超过 500KB，请使用压缩上传"),v.value=!1),(l||a)&&t},f=e=>{const{data:a}=e;a.file&&c("on-success",a.file.url)},j=()=>{i({type:"error",message:"上传失败"}),v.value=!1};return(e,a)=>{const i=u,p=m;return l(),t("div",null,[s(p,{action:`${d.value}/fileUploadAndDownload/upload`,"before-upload":y,headers:{Authorization:"Bearer "+n(g).token},"on-error":j,"on-success":f,"show-file-list":!1,class:"upload-btn"},{default:o((()=>[s(i,{type:"primary"},{default:o((()=>[r("普通上传")])),_:1})])),_:1},8,["action","headers"])])}}}),B={class:"gva-btn-list"},O={class:"media"},K={class:"header-img-box-list"},D={class:"header-img-box-list"},E=c("picture",null,null,-1),I=["onClick"],q={__name:"index",props:{target:{type:Object,default:null},targetKey:{type:String,default:""}},emits:["enterImg"],setup(a,{expose:n,emit:m}){const S=e(""),q=e(""),A=e({}),F=e(1),M=e(0),N=e(20),T=e=>{N.value=e,W()},$=e=>{F.value=e,W()},L=e(!1),P=e([]),W=async()=>{const e=await w({page:F.value,pageSize:N.value,...A.value});0===e.code&&(P.value=e.data.list,M.value=e.data.total,F.value=e.data.page,N.value=e.data.pageSize,L.value=!0)};return n({open:W}),(e,n)=>{const w=f,X=j,Z=u,G=b,H=h,J=C,Q=_,R=k;return l(),p(R,{modelValue:L.value,"onUpdate:modelValue":n[3]||(n[3]=e=>L.value=e),title:"媒体库",size:"650px"},{default:o((()=>[s(z,{title:"点击“文件名/备注”可以编辑文件名或者备注内容。"}),c("div",B,[s(V,{imageCommon:q.value,"onUpdate:imageCommon":n[0]||(n[0]=e=>q.value=e),class:"upload-btn-media-library",onOnSuccess:W},null,8,["imageCommon"]),s(x,{imageUrl:S.value,"onUpdate:imageUrl":n[1]||(n[1]=e=>S.value=e),"file-size":512,"max-w-h":1080,class:"upload-btn-media-library",onOnSuccess:W},null,8,["imageUrl"]),s(G,{ref:"searchForm",inline:!0,model:A.value},{default:o((()=>[s(X,{label:""},{default:o((()=>[s(w,{modelValue:A.value.keyword,"onUpdate:modelValue":n[2]||(n[2]=e=>A.value.keyword=e),class:"keyword",placeholder:"请输入文件名或备注"},null,8,["modelValue"])])),_:1}),s(X,null,{default:o((()=>[s(Z,{type:"primary",icon:"search",onClick:W},{default:o((()=>[r("查询")])),_:1})])),_:1})])),_:1},8,["model"])]),c("div",O,[(l(!0),t(d,null,g(P.value,((e,r)=>(l(),t("div",{key:r,class:"media-box"},[c("div",K,[(l(),p(J,{key:r,src:(e.url&&e.url.slice(0,4),e.url),onClick:l=>{return t=e.url,s=a.target,o=a.targetKey,s&&o&&(s[o]=t),m("enterImg",t),void(L.value=!1);var t,s,o}},{error:o((()=>[c("div",D,[s(H,null,{default:o((()=>[E])),_:1})])])),_:2},1032,["src","onClick"]))]),c("div",{class:"img-title",onClick:a=>(async e=>{y.prompt("请输入文件名或者备注","编辑",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/\S/,inputErrorMessage:"不能为空",inputValue:e.name}).then((async({value:a})=>{e.name=a,0===(await U(e)).code&&(i({type:"success",message:"编辑成功!"}),W())})).catch((()=>{i({type:"info",message:"取消修改"})}))})(e)},v(e.name),9,I)])))),128))]),s(Q,{"current-page":F.value,"page-size":N.value,total:M.value,style:{"justify-content":"center"},layout:"total, prev, pager, next, jumper",onCurrentChange:$,onSizeChange:T},null,8,["current-page","page-size","total"])])),_:1},8,["modelValue"])}}};export{q as _};
