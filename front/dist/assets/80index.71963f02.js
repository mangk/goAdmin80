/*! 
 Build based on gin-vue-admin 
 Time : 1717748743000 */
import{a as e,b as a,o as t,d as l,g as s,w as o,k as r,W as n,m as i,s as u,aL as m,j as p,e as c,F as d,x as g,t as v,X as y,n as f,q as j,E as b,A as h,aP as x,$ as C,ar as _}from"./80index.89ba3368.js";import"./80drawer.4ed993c7.js";import"./80overlay.4ed993c7.js";import"./80pagination.4ed993c7.js";import"./80input.4ed993c7.js";import"./80tag.4ed993c7.js";import"./80select.4ed993c7.js";import"./80scrollbar.4ed993c7.js";import"./80popper.4ed993c7.js";import"./80icon.4ed993c7.js";import"./80form-item.4ed993c7.js";import"./80button.4ed993c7.js";import{U as k,g as w,e as U}from"./80image.f2e48364.js";import"./80progress.4ed993c7.js";import{W as z}from"./80warningBar.e2ffad56.js";const S={name:"UploadCommon",methods:{}},V=Object.assign(S,{emits:["on-success"],setup(p,{emit:c}){const d=e("/_sys"),g=a(),v=e(!1),y=e=>{v.value=!0;const a="image/jpeg"===e.type,t="image/png"===e.type,l=e.size/1024/1024<.5;return a||t||(i.error("上传图片只能是 jpg或png 格式!"),v.value=!1),l||(i.error("未压缩的上传图片大小不能超过 500KB，请使用压缩上传"),v.value=!1),(t||a)&&l},f=e=>{const{data:a}=e;a.file&&c("on-success",a.file.url)},j=()=>{i({type:"error",message:"上传失败"}),v.value=!1};return(e,a)=>{const i=u,p=m;return t(),l("div",null,[s(p,{action:`${d.value}/fileUploadAndDownload/upload`,"before-upload":y,headers:{Authorization:"Bearer "+n(g).token},"on-error":j,"on-success":f,"show-file-list":!1,class:"upload-btn"},{default:o((()=>[s(i,{type:"primary"},{default:o((()=>[r("普通上传")])),_:1})])),_:1},8,["action","headers"])])}}}),B={class:"gva-btn-list"},O={class:"media"},A={class:"header-img-box-list"},E={class:"header-img-box-list"},I=c("picture",null,null,-1),K=["onClick"],P={__name:"index",props:{target:{type:Object,default:null},targetKey:{type:String,default:""}},emits:["enterImg"],setup(a,{expose:n,emit:m}){const S=e(""),P=e(""),T=e({}),W=e(1),$=e(0),D=e(20),F=e=>{D.value=e,J()},L=e=>{W.value=e,J()},M=e(!1),q=e([]),J=async()=>{const e=await w({page:W.value,pageSize:D.value,...T.value});0===e.code&&(q.value=e.data.list,$.value=e.data.total,W.value=e.data.page,D.value=e.data.pageSize,M.value=!0)};return n({open:J}),(e,n)=>{const w=f,N=j,X=u,Z=b,G=h,H=x,Q=C,R=_;return t(),p(R,{modelValue:M.value,"onUpdate:modelValue":n[3]||(n[3]=e=>M.value=e),title:"媒体库",size:"650px"},{default:o((()=>[s(z,{title:"点击“文件名/备注”可以编辑文件名或者备注内容。"}),c("div",B,[s(V,{imageCommon:P.value,"onUpdate:imageCommon":n[0]||(n[0]=e=>P.value=e),class:"upload-btn-media-library",onOnSuccess:J},null,8,["imageCommon"]),s(k,{imageUrl:S.value,"onUpdate:imageUrl":n[1]||(n[1]=e=>S.value=e),"file-size":512,"max-w-h":1080,class:"upload-btn-media-library",onOnSuccess:J},null,8,["imageUrl"]),s(Z,{ref:"searchForm",inline:!0,model:T.value},{default:o((()=>[s(N,{label:""},{default:o((()=>[s(w,{modelValue:T.value.keyword,"onUpdate:modelValue":n[2]||(n[2]=e=>T.value.keyword=e),class:"keyword",placeholder:"请输入文件名或备注"},null,8,["modelValue"])])),_:1}),s(N,null,{default:o((()=>[s(X,{type:"primary",icon:"search",onClick:J},{default:o((()=>[r("查询")])),_:1})])),_:1})])),_:1},8,["model"])]),c("div",O,[(t(!0),l(d,null,g(q.value,((e,r)=>(t(),l("div",{key:r,class:"media-box"},[c("div",A,[(t(),p(H,{key:r,src:(e.url&&e.url.slice(0,4),e.url),onClick:t=>{return l=e.url,s=a.target,o=a.targetKey,s&&o&&(s[o]=l),m("enterImg",l),void(M.value=!1);var l,s,o}},{error:o((()=>[c("div",E,[s(G,null,{default:o((()=>[I])),_:1})])])),_:2},1032,["src","onClick"]))]),c("div",{class:"img-title",onClick:a=>(async e=>{y.prompt("请输入文件名或者备注","编辑",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/\S/,inputErrorMessage:"不能为空",inputValue:e.name}).then((async({value:a})=>{e.name=a,0===(await U(e)).code&&(i({type:"success",message:"编辑成功!"}),J())})).catch((()=>{i({type:"info",message:"取消修改"})}))})(e)},v(e.name),9,K)])))),128))]),s(Q,{"current-page":W.value,"page-size":D.value,total:$.value,style:{"justify-content":"center"},layout:"total, prev, pager, next, jumper",onCurrentChange:L,onSizeChange:F},null,8,["current-page","page-size","total"])])),_:1},8,["modelValue"])}}};export{P as _};
